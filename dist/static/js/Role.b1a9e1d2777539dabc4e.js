webpackJsonp([16],{"8rFt":function(e,t){},S6BS:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),r=a.n(s),o=a("BO1k"),n=a.n(o),l=a("HGcE"),i=a("kq1e"),c={name:"UpdatePwd",props:["accessMgmtVisible","treeOps","treeChkboxProps","formTitle","defaultCheckedKeys","currentRoleId"],data:function(){return{updatePwd:this.formTitle,treeOptions:this.treeOps,checkedAccessArr:[],defCheckedKeys:this.defaultCheckedKeys}},computed:{isShowDialog:{get:function(){return this.accessMgmtVisible},set:function(e){}}},watch:{treeOps:function(e){this.treeOptions=e},defaultCheckedKeys:function(e){this.defCheckedKeys=e}},methods:{handleClose:function(e){var t=this;this.$confirm("确认关闭？").then(function(a){e();t.$emit("handlUpdateForm",{isVisible:!1,actionType:"Cancel"})}).catch(function(e){})},submitForm:function(e){var t={isVisible:!1,actionType:"Submit",checkedAccessArr:this.checkedAccessArr};this.$emit("handlUpdateForm",t)},handleCancel:function(){this.$emit("handlUpdateForm",!1)},handleCheckChange:function(){var e=this.$refs.tree.getCheckedNodes();this.checkedAccessArr=this.recursiveNode(e)},recursiveNode:function(e){var t=[],a=!0,s=!1,r=void 0;try{for(var o,l=n()(e);!(a=(o=l.next()).done);a=!0){var i=o.value;t.push({RightId:0,RoleId:this.currentRoleId.toString(),ResourceId:i.ResourceId.toString(),RightKind:1,Comm:"",Type:0})}}catch(e){s=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw r}}return t}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"access-management-dialog-class",attrs:{title:e.updatePwd,visible:e.isShowDialog,width:"25%","before-close":e.handleClose},on:{"update:visible":function(t){e.isShowDialog=t}}},[a("el-tree",{ref:"tree",attrs:{data:e.treeOptions,"show-checkbox":"","default-expand-all":"","node-key":"MenuId","highlight-current":"",props:e.treeChkboxProps,"default-checked-keys":e.defCheckedKeys,"check-strictly":""},on:{check:e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"access-management-dialog-btn"},[a("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"hasAccess",rawName:"v-hasAccess",value:{accessId:"jbxx_jsgl_qxpz"},expression:"{accessId: 'jbxx_jsgl_qxpz'}"}],staticClass:"submitBtn",attrs:{type:"primary"},on:{click:function(t){e.submitForm()}}},[e._v("提交")])],1)],1)},staticRenderFns:[]};var m=a("VU/8")(c,d,!1,function(e){a("Su/M")},null,null).exports,h=a("F+jZ"),u=a("L2rX"),b={name:"Role",components:{MultiLevelNoTabComponent:l.a,OperationRoleForm:i.a,AccessManagementForm:m},data:function(){return{getUserDataUrl:u.b.rootUrl+u.b.UserAPI.GetUserData,getRoleInfoUrl:u.b.rootUrl+u.b.BaseInfoAPI.GetRoleInfo,getMenuTreeDataUrl:u.b.rootUrl+u.b.BaseInfoAPI.GetMenuTreeData,postAddObj:{params:{Name:"",Code:"",State:"",Comm:""},postUrl:u.b.rootUrl+u.b.BaseInfoAPI.AddRoleInfo},postUpdateObj:{params:{RoleId:"",Name:"",Code:"",State:"",Comm:""},postUrl:u.b.rootUrl+u.b.BaseInfoAPI.UpdateRoleInfo},postDeleteObj:{params:{roleId:""},postUrl:u.b.rootUrl+u.b.BaseInfoAPI.DeleteRoleInfo},exportCheckManageDataUrl:u.b.rootUrl+u.b.ExportCheckManageData,columnFullScore:{rwl:5,sxl:10,wxpyl:15,gjwzl:40,sjhgl:30,pjcscs:0,pjpjsc:0},columnType:{text:"text",router_link:"router_link"},roleSourceData:[],countData:[],addRoleVisible:!1,updateRoleVisible:!1,deleteRoleVisible:!1,accessMgmtVisible:!1,formData:[{headerKey:"Name",headerVal:"角色名称",isReadOnly:!1,columnType:"input",compVal:""},{headerKey:"Code",headerVal:"角色代码",isReadOnly:!0,columnType:"input",compVal:""},{headerKey:"State",headerVal:"是否启用",isReadOnly:!1,columnType:"select",compVal:1,options:[{value:1,label:"启用"},{value:0,label:"禁用"}]},{headerKey:"Comm",headerVal:"备注",isReadOnly:!1,columnType:"input",compVal:""}],formTitle:"增加角色管理信息",formUpdateTitle:"修改角色管理信息",formDeleteTitle:"你确定要删除该角色吗？",formAccessmgmntTitle:"权限配置",isSelectedRow:!1,currentRoleId:"",treeOps:[],defaultCheckedKeys:[],treeChkboxProps:{label:"Name",chidlren:"children"}}},computed:{tabCtntList:function(){return{currentPage:1,total:0,loading:!1,btnEvents:[{iconName:"el-icon-search",btnId:u.b.btnEventsId.search,btnName:"查询",isDisabled:!1,ctrlId:"jbxx_jsgl_cx"},{iconName:"el-icon-circle-plus-outline",btnId:u.b.btnEventsId.add,btnName:"增加",isDisabled:!1,ctrlId:"jbxx_jsgl_zj"},{iconName:"el-icon-edit",btnId:u.b.btnEventsId.edit,btnName:"修改",isDisabled:!1,ctrlId:"jbxx_jsgl_xg"},{iconName:"el-icon-delete",btnId:u.b.btnEventsId.delete,btnName:"删除",isDisabled:!1,ctrlId:"jbxx_jsgl_sc"},{iconName:"el-icon-setting",btnId:u.b.btnEventsId.accessmgmnt,btnName:"权限配置",isDisabled:!1,ctrlId:"jbxx_jsgl_qxpz"}],searchCreteria:[{searchType:"input",labelName:"角色名称",labelId:u.d.RoleName,compVal:""},{searchType:"input",labelName:"角色代码",labelId:u.d.RoleCode,compVal:""}],tabHeader:[{headerKey:"sybid",headerVal:"序号",subHeaders:[]},{headerKey:"Name",headerVal:"角色名称",subHeaders:[]},{headerKey:"Code",headerVal:"角色代码",subHeaders:[]},{headerKey:"State",headerVal:"是否启用",subHeaders:[]},{headerKey:"Comm",headerVal:"备注",subHeaders:[]}],TabCtnt:[]}}},methods:{handleClickSearch:function(e){var t=this;h.q.setItem(u.b.ctrlId,"jbxx_jsgl_cx");var a=t.formPageParams(e.searchCreteria,e.currentPage,e.isSplitPage);t.tabCtntList.loading=!0,t.roleSourceData=[],h.a.axiosGet(this.getRoleInfoUrl,a).then(function(e){if(Object(h.o)(e.data))t.tabCtntList.TabCtnt=[],t.tabCtntList.loading=!1;else{var a=e.data;for(var s in a)t.roleSourceData.push(t.pushSourceData(parseInt(s)+1,a[s]));t.tabCtntList.loading=!1,t.tabCtntList.TabCtnt=t.roleSourceData,t.tabCtntList.total=e.data.CountTotal,t.tabCtntList.btnEvents[1].isDisabled=!1}}).catch(function(e){t.$message.error(Object(h.l)(e))})},pushSourceData:function(e,t){var a="";return a=t.State?"是":"否",{sybid:e,Name:t.Name,RoleId:t.RoleId,Code:t.Code,State:a,Comm:t.Comm}},handleClickExpData:function(e){var t=this;t.tabCtntList.loading=!0;var a=t.formPageParams(e.searchCreteria,e.currentPage,e.isSplitPage);h.a.axiosGet(this.exportCheckManageDataUrl,a).then(function(e){t.downloadServerFile(decodeURIComponent(e.data)),t.tabCtntList.loading=!1}).catch(function(e){t.$message.error(Object(h.l)(e))})},formPageParams:function(e,t,a){var s="",r="",o=!0,l=!1,i=void 0;try{for(var c,d=n()(e);!(o=(c=d.next()).done);o=!0){var m=c.value;switch(m.labelId){case u.d.RoleName:s=m.compVal;break;case u.d.RoleCode:r=m.compVal}}}catch(e){l=!0,i=e}finally{try{!o&&d.return&&d.return()}finally{if(l)throw i}}return{RoleName:s,RoleCode:r,pageSize:10,pageIndex:t,isSplitPage:a,readPage:""}},handleCurrentChange:function(e){this.handleClickSearch(e)},downloadServerFile:function(e){var t=document.createElement("a");t.href=e,t.click()},handleAddEvent:function(e){this.addRoleVisible=e;var t=!0,a=!1,s=void 0;try{for(var r,o=n()(this.formData);!(t=(r=o.next()).done);t=!0){var l=r.value;switch(l.headerKey){case"Name":case"Code":case"State":case"Comm":l.compVal=""}}}catch(e){a=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw s}}},handleEditBtn:function(e){this.isSelectedRow?this.updateRoleVisible=e:this.$message.error("请选择一行数据")},handleDeleteBtn:function(e){this.isSelectedRow?this.deleteRoleVisible=e:this.$message.error("请选择一行数据")},handleAccessmgmntBtn:function(e){var t=this;if(h.q.setItem(u.b.ctrlId,"jbxx_jsgl_qxpz"),this.isSelectedRow){var a={RoleId:this.currentRoleId};h.a.axiosGet(this.getMenuTreeDataUrl,a).then(function(e){t.$store.commit("updateChkAccessMgmtceArr",[]),t.treeOps=e.data,Object(h.b)(t.treeOps),t.defaultCheckedKeys=t.$store.state.chkAccessMgmtceArr,console.log(t.defaultCheckedKeys)}).catch(function(e){t.$message.error(Object(h.l)(e))}),this.accessMgmtVisible=e}else this.$message.error("请选择一行数据")},handleAddCancelSubmitEvent:function(e){var t=this;if(h.q.setItem(u.b.ctrlId,"jbxx_jsgl_zj"),this.addRoleVisible=e.isVisible,"Submit"===e.actionType){var a=!0,s=!1,r=void 0;try{for(var o,l=n()(e.formColumnNames);!(a=(o=l.next()).done);a=!0){var i=o.value;switch(i.headerKey){case"Name":t.postAddObj.params.Name=i.compVal;break;case"Code":t.postAddObj.params.Code=i.compVal;break;case"State":t.postAddObj.params.State=i.compVal;break;case"Comm":t.postAddObj.params.Comm=i.compVal}}}catch(e){s=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw r}}h.a.axiosPost(t.postAddObj).then(function(e){0===e.data?(t.$message({message:"恭喜你，修改信息成功",type:"success"}),t.addRoleVisible=!1,t.handleClickSearch({currentPage:1,searchCreteria:t.tabCtntList.searchCreteria,isSplitPage:!0})):-1===e.data?(t.addRoleVisible=!0,t.$message.error("角色已存在，请重新添加")):(t.addRoleVisible=!0,t.$message.error("错了哦，修改信息失败"))}).catch(function(e){t.$message.error(Object(h.l)(e))})}},handleUpdateCancelSubmitEvent:function(e){var t=this;if(h.q.setItem(u.b.ctrlId,"jbxx_jsgl_xg"),this.updateRoleVisible=e.isVisible,"Submit"===e.actionType){var a=!0,s=!1,r=void 0;try{for(var o,l=n()(e.formColumnNames);!(a=(o=l.next()).done);a=!0){var i=o.value;switch(i.headerKey){case"Name":t.postUpdateObj.params.Name=i.compVal;break;case"Code":t.postUpdateObj.params.Code=i.compVal;break;case"State":t.postUpdateObj.params.State=i.compVal;break;case"Comm":t.postUpdateObj.params.Comm=i.compVal}}}catch(e){s=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw r}}h.a.axiosPost(t.postUpdateObj).then(function(e){e.data?(t.$message({message:"恭喜你，修改信息成功",type:"success"}),t.updateRoleVisible=!1,t.handleClickSearch({currentPage:1,searchCreteria:t.tabCtntList.searchCreteria,isSplitPage:!0})):t.$message.error("错了哦，修改信息失败")}).catch(function(e){t.$message.error(Object(h.l)(e))})}},handleDeleteCancelSubmitEvent:function(e){var t=this;h.q.setItem(u.b.ctrlId,"jbxx_jsgl_sc"),this.deleteRoleVisible=e.isVisible,"Submit"===e.actionType&&h.a.axiosPost(t.postDeleteObj).then(function(e){e.data?(t.$message({message:"恭喜你，删除信息成功",type:"success"}),t.deleteRoleVisible=!1,t.handleClickSearch({currentPage:1,searchCreteria:t.tabCtntList.searchCreteria,isSplitPage:!0})):t.$message.error("错了哦，删除信息失败")}).catch(function(e){t.$message.error(Object(h.l)(e))})},handleAccessMgmtSubmitEvent:function(e){var t=this;this.accessMgmtVisible=e.isVisible,h.q.setItem(u.b.ctrlId,"jbxx_jsgl_qxpz_xg"),"Submit"===e.actionType&&(this.postSaveRightObj={params:{menuList:r()(e.checkedAccessArr),roleId:this.currentRoleId,reList:r()([])},postUrl:u.b.rootUrl+u.b.BaseInfoAPI.SaveRightData},h.a.axiosPost(t.postSaveRightObj).then(function(e){e.data?(t.$message({message:"恭喜你，修改权限配置信息成功",type:"success"}),t.accessMgmtVisible=!1,t.getUserData()):t.$message.error("错了哦，修改权限配置信息失败")}).catch(function(e){t.$message.error(Object(h.l)(e))}))},handleRowClick:function(e){this.isSelectedRow=!0,this.postUpdateObj.params.UnitId=e.UnitID;var t=!0,a=!1,s=void 0;try{for(var r,o=n()(this.formData);!(t=(r=o.next()).done);t=!0){var l=r.value;switch(l.headerKey){case"Name":l.compVal=e.Name;break;case"Code":l.compVal=e.Code;break;case"State":l.compVal=e.State;break;case"Comm":l.compVal=e.Comm}}}catch(e){a=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw s}}this.postUpdateObj.params.RoleId=e.RoleId,this.postDeleteObj.params.roleId=e.RoleId,this.currentRoleId=e.RoleId},getUserData:function(){var e=this;h.q.setItem(u.b.ctrlId,"");var t={loginCode:h.q.getItem(u.b.LoginID)};h.a.axiosGet(this.getUserDataUrl,t).then(function(t){e.$store.commit("updateUsrAccessManagement",t.data),h.q.setItem("accessList",r()(t.data))}).catch(function(e){})}},beforeMount:function(){var e=JSON.parse(h.q.getItem("breadNavs"));this.$emit("viewIn",e)}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role"},[a("multi-level-no-tab-component",{staticClass:"role-multilevel",attrs:{tabCtntList:e.tabCtntList},on:{handleClickSearch:e.handleClickSearch,handleClickExpData:e.handleClickExpData,handleCurrentChange:e.handleCurrentChange,handleEditBtn:e.handleEditBtn,handleAddEvent:e.handleAddEvent,handleRowClick:e.handleRowClick,handleDeleteBtn:e.handleDeleteBtn,handleAccessmgmntBtn:e.handleAccessmgmntBtn}}),e._v(" "),a("operation-role-form",{attrs:{updateCompanyFormVisible:e.addRoleVisible,formData:e.formData,formTitle:e.formTitle},on:{handlUpdateForm:e.handleAddCancelSubmitEvent}}),e._v(" "),a("operation-role-form",{attrs:{updateCompanyFormVisible:e.updateRoleVisible,formData:e.formData,formTitle:e.formUpdateTitle},on:{handlUpdateForm:e.handleUpdateCancelSubmitEvent}}),e._v(" "),a("operation-role-form",{attrs:{updateCompanyFormVisible:e.deleteRoleVisible,formTitle:e.formDeleteTitle},on:{handlUpdateForm:e.handleDeleteCancelSubmitEvent}}),e._v(" "),a("access-management-form",{attrs:{accessMgmtVisible:e.accessMgmtVisible,formTitle:e.formAccessmgmntTitle,treeOps:e.treeOps,treeChkboxProps:e.treeChkboxProps,defaultCheckedKeys:e.defaultCheckedKeys,currentRoleId:e.currentRoleId},on:{handlUpdateForm:e.handleAccessMgmtSubmitEvent}})],1)},staticRenderFns:[]};var f=a("VU/8")(b,p,!1,function(e){a("8rFt")},null,null);t.default=f.exports},"Su/M":function(e,t){}});
//# sourceMappingURL=Role.b1a9e1d2777539dabc4e.js.map